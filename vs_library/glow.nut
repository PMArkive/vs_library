//-----------------------------------------------------------------------
//------------------- Copyright (c) samisalreadytaken -------------------
//                       github.com/samisalreadytaken
//- v1.0.8 --------------------------------------------------------------
//
// ::Glow.Set(hPlayer, color, nType, flDistance)
// ::Glow.Disable(hPlayer)
//
IncludeScript("vs_library");if(!("Glow"in::getroottable())||typeof::Glow!="table"||!("Set"in::Glow)){local AddEvent=::DoEntFireByInstanceHandle;local Create=::CreateProp;::Glow<-{function Set(src,color,style,dist):(Create){local glow=Get(src);if(glow){if(DEBUG)Msg("Glow::Set: Updating glow ["+src.entindex()+"]\n")}else{if(DEBUG)Msg("Glow::Set: Setting glow ["+src.entindex()+"]\n");foreach(e in m_list)if(e)if(!e.GetMoveParent()){glow=e;break};;if(glow){glow.SetModel(src.GetModelName())}else{glow=Create("prop_dynamic_glow",src.GetOrigin(),src.GetModelName(),0);m_list.append(glow.weakref())};glow.__KeyValueFromInt("rendermode",6);glow.__KeyValueFromInt("renderamt",0);::VS.SetParent(glow,src);::VS.MakePersistent(glow)};if(typeof color=="string")glow.__KeyValueFromString("glowcolor",color);else if(typeof color=="Vector")glow.__KeyValueFromVector("glowcolor",color);else throw"parameter 2 has an invalid type '"+typeof color+"' ; expected 'string|Vector'";;glow.__KeyValueFromInt("glowstyle",style);glow.__KeyValueFromFloat("glowdist",dist);glow.__KeyValueFromInt("glowenabled",1);glow.__KeyValueFromInt("effects",18433);return glow}function Disable(src):(AddEvent){local glow=Get(src);if(glow){glow.__KeyValueFromInt("effects",18465);::VS.SetParent(glow,null);AddEvent(glow,"setglowdisabled","",0.0,null,null);if(DEBUG)Msg("Glow::Disable: Disabled glow ["+src.entindex()+"]\n")}else{if(DEBUG)Msg("Glow::Disable: No glow found ["+src.entindex()+"]\n")};return glow}function Get(src){if(!src||!src.GetModelName().len())throw"Glow: Invalid source entity";for(local i=m_list.len();i--;){local g=m_list[i];if(g){if(g.GetMoveParent()==src)return g}else m_list.remove(i)}}Msg=::print,DEBUG=false,m_list=[]}};;
